"use strict";
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const jest_mock_axios_1 = __importDefault(require("jest-mock-axios"));
const utxos_1 = require("../../../src/apis/platformvm/utxos");
const keychain_1 = require("../../../src/apis/platformvm/keychain");
const inputs_1 = require("../../../src/apis/platformvm/inputs");
const create_hash_1 = __importDefault(require("create-hash"));
const bintools_1 = __importDefault(require("../../../src/utils/bintools"));
const bn_js_1 = __importDefault(require("bn.js"));
const buffer_1 = require("buffer/");
const outputs_1 = require("../../../src/apis/platformvm/outputs");
const constants_1 = require("../../../src/apis/platformvm/constants");
const index_1 = require("../../../src/index");
const platformvm_1 = require("src/apis/platformvm");
const platformvm_2 = require("src/apis/platformvm");
const utils_1 = require("src/utils");
describe("CreateChainTx", () => {
    /**
     * @ignore
     */
    const bintools = bintools_1.default.getInstance();
    const alias = "X";
    const amnt = utils_1.ONEAVAX.toNumber();
    const assetID = bintools.cb58Decode("2fombhL7aGPwj3KH4bfrmJwW6PVnMobf9Y2fn9GwxiAAJyFDbe");
    let amount;
    let addresses;
    let locktime;
    let threshold;
    const ip = "127.0.0.1";
    const port = 8080;
    const protocol = "http";
    const networkID = 1337;
    const avalanche = new index_1.Avalanche(ip, port, protocol, networkID);
    const pchain = avalanche.PChain();
    const pChainBlockchainID = "11111111111111111111111111111111LpoYY";
    const genesisDataStr = "11111DdZMhYXUZiFV9FNpfpTSQroysjHyMuT5zapYkPYrmap7t7S3sDNNwFzngxR9x1XmoRj5JK1XomX8RHvXYY5h3qYeEsMQRF8Ypia7p1CFHDo6KGSjMdiQkrmpvL8AvoezSxVWKXt2ubmBCnSkpPjnQbBSF7gNg4sPu1PXdh1eKgthaSFREqqG5FKMrWNiS6U87kxCmbKjkmBvwnAd6TpNx75YEiS9YKMyHaBZjkRDNf6Nj1";
    const subnetIDStr = "LtYUqdbbLzTmHMXPPVhAHMeDr6riEmt2pjtfEiqAqAce9MxCg";
    const memoStr = "from snowflake to avalanche";
    const blockchainID = utils_1.Defaults.network[avalanche.getNetworkID()].P["blockchainID"];
    const memo = buffer_1.Buffer.from(memoStr, "utf8");
    const subnetID = bintools.cb58Decode(subnetIDStr);
    const chainNameStr = "EPIC AVM";
    const vmIDStr = "avm";
    const fxIDsStr = ["nftfx", "propertyfx", "secp256k1fx"];
    const gd = new index_1.GenesisData();
    gd.fromBuffer(bintools.cb58Decode(genesisDataStr));
    const addressIndex = buffer_1.Buffer.alloc(4);
    addressIndex.writeUIntBE(0x0, 0, 4);
    const subnetAuth = new platformvm_1.SubnetAuth([addressIndex]);
    let keymgr1 = new keychain_1.KeyChain(avalanche.getHRP(), alias);
    let keymgr2 = new keychain_1.KeyChain(avalanche.getHRP(), alias);
    let keymgr3 = new keychain_1.KeyChain(avalanche.getHRP(), alias);
    let addrs1 = [];
    let addrs2 = [];
    let addrs3 = [];
    let utxos = [];
    let set = new platformvm_2.UTXOSet();
    let inputs = [];
    let outputs = [];
    for (let i = 0; i < 3; i++) {
        addrs1.push(keymgr1.makeKey().getAddress());
        addrs2.push(keymgr2.makeKey().getAddress());
        addrs3.push(keymgr3.makeKey().getAddress());
    }
    amount = new bn_js_1.default(amnt);
    addresses = keymgr1.getAddresses();
    locktime = new bn_js_1.default(54321);
    threshold = 3;
    for (let i = 0; i < 5; i++) {
        const bn = new bn_js_1.default(i);
        let length = 32;
        let txid = buffer_1.Buffer.from((0, create_hash_1.default)("sha256").update(bintools.fromBNToBuffer(bn, length)).digest());
        length = 4;
        let txidx = buffer_1.Buffer.from(bintools.fromBNToBuffer(bn, length));
        const out = new outputs_1.SECPTransferOutput(amount, addresses, locktime, threshold);
        const xferout = new outputs_1.TransferableOutput(assetID, out);
        outputs.push(xferout);
        const u = new utxos_1.UTXO(constants_1.PlatformVMConstants.LATESTCODEC, txid, txidx, assetID, out);
        utxos.push(u);
        txid = u.getTxID();
        txidx = u.getOutputIdx();
        const input = new inputs_1.SECPTransferInput(amount);
        const xferin = new inputs_1.TransferableInput(txid, txidx, assetID, input);
        inputs.push(xferin);
    }
    set.addArray(utxos);
    const createChainTx = new platformvm_1.CreateChainTx(networkID, bintools.cb58Decode(pChainBlockchainID), outputs, inputs, memo, subnetID, chainNameStr, vmIDStr, fxIDsStr, gd, subnetAuth);
    test("buildCreateChainTx", () => __awaiter(void 0, void 0, void 0, function* () {
        const addrs1Strs = addrs1.map((a) => bintools.addressToString("local", "P", a));
        const result = pchain.buildCreateChainTx(set, addrs1Strs, addrs1Strs, subnetID, chainNameStr, vmIDStr, fxIDsStr, gd, subnetAuth, memo);
        const payload = {
            result: {
                assetID: "2fombhL7aGPwj3KH4bfrmJwW6PVnMobf9Y2fn9GwxiAAJyFDbe"
            }
        };
        const responseObj = {
            data: payload
        };
        jest_mock_axios_1.default.mockResponse(responseObj);
        const txu1 = yield result;
        const txu2 = set.buildCreateChainTx(networkID, bintools.cb58Decode(blockchainID), addrs1, addrs1, subnetID, chainNameStr, vmIDStr, fxIDsStr, gd, subnetAuth, pchain.getCreateChainTxFee(), assetID, memo);
        expect(txu2.toBuffer().toString("hex")).toBe(txu1.toBuffer().toString("hex"));
        expect(txu2.toString()).toBe(txu1.toString());
        const tx = txu1.getTransaction();
        const txType = tx.getTxType();
        expect(txType).toBe(constants_1.PlatformVMConstants.CREATECHAINTX);
        const sa = tx.getSubnetAuth();
        expect(sa).toBe(subnetAuth);
        const sID = tx.getSubnetID();
        expect(sID).toBe(subnetIDStr);
        const vID = tx.getVMID();
        expect(vID.toString()).toMatch(vmIDStr);
        const cName = tx.getChainName();
        expect(cName).toBe(chainNameStr);
        const fIDs = tx.getFXIDs();
        expect(fIDs.length).toBe(3);
        fIDs.forEach((fxID, index) => {
            expect(fxID.toString()).toMatch(fxIDsStr[index]);
        });
        const gData = tx.getGenesisData();
        expect(gData).toBe(genesisDataStr);
    }));
    test("createChainTx getChainName", () => {
        const chainName = createChainTx.getChainName();
        expect(chainName).toBe(chainNameStr);
    });
    test("createChainTx getTxType", () => {
        const txType = createChainTx.getTxType();
        expect(txType).toBe(constants_1.PlatformVMConstants.CREATECHAINTX);
    });
    test("createChainTx getSubnetAuth", () => {
        const sa = createChainTx.getSubnetAuth();
        expect(sa).toBe(subnetAuth);
    });
    test("createChainTx getSubnetID", () => {
        const subnetID = createChainTx.getSubnetID();
        expect(subnetID).toBe(subnetIDStr);
    });
    test("createChainTx getVMID", () => {
        const vmID = createChainTx.getVMID();
        expect(vmID.toString()).toMatch(vmIDStr);
    });
    test("createChainTx getChainName", () => {
        const chainName = createChainTx.getChainName();
        expect(chainName).toBe(chainNameStr);
    });
    test("createChainTx getFXIDs", () => {
        const fxIDs = createChainTx.getFXIDs();
        expect(fxIDs.length).toBe(3);
        fxIDs.forEach((fxID, index) => {
            expect(fxID.toString()).toMatch(fxIDsStr[index]);
        });
    });
    test("createChainTx getGenesisData", () => {
        const genesisData = createChainTx.getGenesisData();
        expect(genesisData).toBe(genesisDataStr);
    });
    test("createChainTx fromBuffer", () => {
        const createChainTxBuf = createChainTx.toBuffer();
        const createChainTx2 = new platformvm_1.CreateChainTx();
        createChainTx2.fromBuffer(createChainTxBuf);
        expect(createChainTxBuf.toString("hex")).toMatch(createChainTx2.toBuffer().toString("hex"));
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlY2hhaW50eC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdGVzdHMvYXBpcy9wbGF0Zm9ybXZtL2NyZWF0ZWNoYWludHgudGVzdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7OztBQUFBLHNFQUF1QztBQUN2Qyw4REFBeUQ7QUFDekQsb0VBQWdFO0FBQ2hFLGdFQUc0QztBQUM1Qyw4REFBb0M7QUFDcEMsMkVBQWtEO0FBQ2xELGtEQUFzQjtBQUN0QixvQ0FBZ0M7QUFDaEMsa0VBRzZDO0FBQzdDLHNFQUE0RTtBQUM1RSw4Q0FBMkQ7QUFDM0Qsb0RBSzRCO0FBQzVCLG9EQUE2QztBQUU3QyxxQ0FBNkM7QUFFN0MsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7SUFDN0I7O09BRUc7SUFDSCxNQUFNLFFBQVEsR0FBYSxrQkFBUSxDQUFDLFdBQVcsRUFBRSxDQUFBO0lBRWpELE1BQU0sS0FBSyxHQUFXLEdBQUcsQ0FBQTtJQUN6QixNQUFNLElBQUksR0FBVyxlQUFPLENBQUMsUUFBUSxFQUFFLENBQUE7SUFDdkMsTUFBTSxPQUFPLEdBQVcsUUFBUSxDQUFDLFVBQVUsQ0FDekMsb0RBQW9ELENBQ3JELENBQUE7SUFDRCxJQUFJLE1BQVUsQ0FBQTtJQUNkLElBQUksU0FBbUIsQ0FBQTtJQUN2QixJQUFJLFFBQVksQ0FBQTtJQUNoQixJQUFJLFNBQWlCLENBQUE7SUFDckIsTUFBTSxFQUFFLEdBQVcsV0FBVyxDQUFBO0lBQzlCLE1BQU0sSUFBSSxHQUFXLElBQUksQ0FBQTtJQUN6QixNQUFNLFFBQVEsR0FBVyxNQUFNLENBQUE7SUFDL0IsTUFBTSxTQUFTLEdBQVcsSUFBSSxDQUFBO0lBQzlCLE1BQU0sU0FBUyxHQUFjLElBQUksaUJBQVMsQ0FBQyxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxTQUFTLENBQUMsQ0FBQTtJQUN6RSxNQUFNLE1BQU0sR0FBa0IsU0FBUyxDQUFD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LFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQTtJQUMxQyxDQUFDLENBQUMsQ0FBQTtJQUNGLElBQUksQ0FBQywwQkFBMEIsRUFBRSxHQUFTLEVBQUU7UUFDMUMsTUFBTSxnQkFBZ0IsR0FBVyxhQUFhLENBQUMsUUFBUSxFQUFFLENBQUE7UUFDekQsTUFBTSxjQUFjLEdBQWtCLElBQUksMEJBQWEsRUFBRSxDQUFBO1FBQ3pELGNBQWMsQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsQ0FBQTtRQUMzQyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUM5QyxjQUFjLENBQUMsUUFBUSxFQUFFLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUMxQyxDQUFBO0lBQ0gsQ0FBQyxDQUFDLENBQUE7QUFDSixDQUFDLENBQUMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb2NrQXhpb3MgZnJvbSBcImplc3QtbW9jay1heGlvc1wiXG5pbXBvcnQgeyBVVFhPIH0gZnJvbSBcIi4uLy4uLy4uL3NyYy9hcGlzL3BsYXRmb3Jtdm0vdXR4b3NcIlxuaW1wb3J0IHsgS2V5Q2hhaW4gfSBmcm9tIFwiLi4vLi4vLi4vc3JjL2FwaXMvcGxhdGZvcm12bS9rZXljaGFpblwiXG5pbXBvcnQge1xuICBTRUNQVHJhbnNmZXJJbnB1dCxcbiAgVHJhbnNmZXJhYmxlSW5wdXRcbn0gZnJvbSBcIi4uLy4uLy4uL3NyYy9hcGlzL3BsYXRmb3Jtdm0vaW5wdXRzXCJcbmltcG9ydCBjcmVhdGVIYXNoIGZyb20gXCJjcmVhdGUtaGFzaFwiXG5pbXBvcnQgQmluVG9vbHMgZnJvbSBcIi4uLy4uLy4uL3NyYy91dGlscy9iaW50b29sc1wiXG5pbXBvcnQgQk4gZnJvbSBcImJuLmpzXCJcbmltcG9ydCB7IEJ1ZmZlciB9IGZyb20gXCJidWZmZXIvXCJcbmltcG9ydCB7XG4gIFNFQ1BUcmFuc2Zlck91dHB1dCxcbiAgVHJhbnNmZXJhYmxlT3V0cHV0XG59IGZyb20gXCIuLi8uLi8uLi9zcmMvYXBpcy9wbGF0Zm9ybXZtL291dHB1dHNcIlxuaW1wb3J0IHsgUGxhdGZvcm1WTUNvbnN0YW50cyB9IGZyb20gXCIuLi8uLi8uLi9zcmMvYXBpcy9wbGF0Zm9ybXZtL2NvbnN0YW50c1wiXG5pbXBvcnQgeyBBdmFsYW5jaGUsIEdlbmVzaXNEYXRhIH0gZnJvbSBcIi4uLy4uLy4uL3NyYy9pbmRleFwiXG5pbXBvcnQge1xuICBDcmVhdGVDaGFpblR4LFxuICBTdWJuZXRBdXRoLFxuICBQbGF0Zm9ybVZNQVBJLFxuICBVbnNpZ25lZFR4XG59IGZyb20gXCJzcmMvYXBpcy9wbGF0Zm9ybXZtXCJcbmltcG9ydCB7IFVUWE9TZXQgfSBmcm9tIFwic3JjL2FwaXMvcGxhdGZvcm12bVwiXG5pbXBvcnQgeyBIdHRwUmVzcG9uc2UgfSBmcm9tIFwiamVzdC1tb2NrLWF4aW9zL2Rpc3QvbGliL21vY2stYXhpb3MtdHlwZXNcIlxuaW1wb3J0IHsgRGVmYXVsdHMsIE9ORUFWQVggfSBmcm9tIFwic3JjL3V0aWxzXCJcblxuZGVzY3JpYmUoXCJDcmVhdGVDaGFpblR4XCIsICgpID0+IHtcbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIGNvbnN0IGJpbnRvb2xzOiBCaW5Ub29scyA9IEJpblRvb2xzLmdldEluc3RhbmNlKClcblxuICBjb25zdCBhbGlhczogc3RyaW5nID0gXCJYXCJcbiAgY29uc3QgYW1udDogbnVtYmVyID0gT05FQVZBWC50b051bWJlcigpXG4gIGNvbnN0IGFzc2V0SUQ6IEJ1ZmZlciA9IGJpbnRvb2xzLmNiNThEZWNvZGUoXG4gICAgXCIyZm9tYmhMN2FHUHdqM0tINGJmcm1Kd1c2UFZuTW9iZjlZMmZuOUd3eGlBQUp5RkRiZVwiXG4gIClcbiAgbGV0IGFtb3VudDogQk5cbiAgbGV0IGFkZHJlc3NlczogQnVmZmVyW11cbiAgbGV0IGxvY2t0aW1lOiBCTlxuICBsZXQgdGhyZXNob2xkOiBudW1iZXJcbiAgY29uc3QgaXA6IHN0cmluZyA9IFwiMTI3LjAuMC4xXCJcbiAgY29uc3QgcG9ydDogbnVtYmVyID0gODA4MFxuICBjb25zdCBwcm90b2NvbDogc3RyaW5nID0gXCJodHRwXCJcbiAgY29uc3QgbmV0d29ya0lEOiBudW1iZXIgPSAxMzM3XG4gIGNvbnN0IGF2YWxhbmNoZTogQXZhbGFuY2hlID0gbmV3IEF2YWxhbmNoZShpcCwgcG9ydCwgcHJvdG9jb2wsIG5ldHdvcmtJRClcbiAgY29uc3QgcGNoYWluOiBQbGF0Zm9ybVZNQVBJID0gYXZhbGFuY2hlLlBDaGFpbigpXG4gIGNvbnN0IHBDaGFpbkJsb2NrY2hhaW5JRDogc3RyaW5nID0gXCIxMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMUxwb1lZXCJcbiAgY29uc3QgZ2VuZXNpc0RhdGFTdHI6IHN0cmluZyA9XG4gICAgXCIxMTExMURkWk1oWVhVWmlGVjlGTnBmcFRTUXJveXNqSHlNdVQ1emFwWWtQWXJtYXA3dDdTM3NETk53RnpuZ3hSOXgxWG1vUmo1SksxWG9tWDhSSHZYWVk1aDNxWWVFc01RUkY4WXBpYTdwMUNGSERvNktHU2pNZGlRa3JtcHZMOEF2b2V6U3hWV0tYdDJ1Ym1CQ25Ta3BQam5RYkJTRjdnTmc0c1B1MVBYZGgxZUtndGhhU0ZSRXFxRzVGS01yV05pUzZVODdreENtYktqa21CdnduQWQ2VHBOeDc1WUVpUzlZS015SGFCWmprUkROZjZOajFcIlxuICBjb25zdCBzdWJuZXRJRFN0cjogc3RyaW5nID1cbiAgICBcIkx0WVVxZGJiTHpUbUhNWFBQVmhBSE1lRHI2cmlFbXQycGp0ZkVpcUFxQWNlOU14Q2dcIlxuICBjb25zdCBtZW1vU3RyOiBzdHJpbmcgPSBcImZyb20gc25vd2ZsYWtlIHRvIGF2YWxhbmNoZVwiXG4gIGNvbnN0IGJsb2NrY2hhaW5JRDogc3RyaW5nID1cbiAgICBEZWZhdWx0cy5uZXR3b3JrW2F2YWxhbmNoZS5nZXROZXR3b3JrSUQoKV0uUFtcImJsb2NrY2hhaW5JRFwiXVxuICBjb25zdCBtZW1vOiBCdWZmZXIgPSBCdWZmZXIuZnJvbShtZW1vU3RyLCBcInV0ZjhcIilcbiAgY29uc3Qgc3VibmV0SUQ6IEJ1ZmZlciA9IGJpbnRvb2xzLmNiNThEZWNvZGUoc3VibmV0SURTdHIpXG4gIGNvbnN0IGNoYWluTmFtZVN0cjogc3RyaW5nID0gXCJFUElDIEFWTVwiXG4gIGNvbnN0IHZtSURTdHI6IHN0cmluZyA9IFwiYXZtXCJcbiAgY29uc3QgZnhJRHNTdHI6IHN0cmluZ1tdID0gW1wibmZ0ZnhcIiwgXCJwcm9wZXJ0eWZ4XCIsIFwic2VjcDI1NmsxZnhcIl1cbiAgY29uc3QgZ2Q6IEdlbmVzaXNEYXRhID0gbmV3IEdlbmVzaXNEYXRhKClcbiAgZ2QuZnJvbUJ1ZmZlcihiaW50b29scy5jYjU4RGVjb2RlKGdlbmVzaXNEYXRhU3RyKSlcbiAgY29uc3QgYWRkcmVzc0luZGV4OiBCdWZmZXIgPSBCdWZmZXIuYWxsb2MoNClcbiAgYWRkcmVzc0luZGV4LndyaXRlVUludEJFKDB4MCwgMCwgNClcbiAgY29uc3Qgc3VibmV0QXV0aDogU3VibmV0QXV0aCA9IG5ldyBTdWJuZXRBdXRoKFthZGRyZXNzSW5kZXhdKVxuICBsZXQga2V5bWdyMTogS2V5Q2hhaW4gPSBuZXcgS2V5Q2hhaW4oYXZhbGFuY2hlLmdldEhSUCgpLCBhbGlhcylcbiAgbGV0IGtleW1ncjI6IEtleUNoYWluID0gbmV3IEtleUNoYWluKGF2YWxhbmNoZS5nZXRIUlAoKSwgYWxpYXMpXG4gIGxldCBrZXltZ3IzOiBLZXlDaGFpbiA9IG5ldyBLZXlDaGFpbihhdmFsYW5jaGUuZ2V0SFJQKCksIGFsaWFzKVxuICBsZXQgYWRkcnMxOiBCdWZmZXJbXSA9IFtdXG4gIGxldCBhZGRyczI6IEJ1ZmZlcltdID0gW11cbiAgbGV0IGFkZHJzMzogQnVmZmVyW10gPSBbXVxuICBsZXQgdXR4b3M6IFVUWE9bXSA9IFtdXG4gIGxldCBzZXQ6IFVUWE9TZXQgPSBuZXcgVVRYT1NldCgpXG4gIGxldCBpbnB1dHM6IFRyYW5zZmVyYWJsZUlucHV0W10gPSBbXVxuICBsZXQgb3V0cHV0czogVHJhbnNmZXJhYmxlT3V0cHV0W10gPSBbXVxuICBmb3IgKGxldCBpOiBudW1iZXIgPSAwOyBpIDwgMzsgaSsrKSB7XG4gICAgYWRkcnMxLnB1c2goa2V5bWdyMS5tYWtlS2V5KCkuZ2V0QWRkcmVzcygpKVxuICAgIGFkZHJzMi5wdXNoKGtleW1ncjIubWFrZUtleSgpLmdldEFkZHJlc3MoKSlcbiAgICBhZGRyczMucHVzaChrZXltZ3IzLm1ha2VLZXkoKS5nZXRBZGRyZXNzKCkpXG4gIH1cbiAgYW1vdW50ID0gbmV3IEJOKGFtbnQpXG4gIGFkZHJlc3NlcyA9IGtleW1ncjEuZ2V0QWRkcmVzc2VzKClcbiAgbG9ja3RpbWUgPSBuZXcgQk4oNTQzMjEpXG4gIHRocmVzaG9sZCA9IDNcblxuICBmb3IgKGxldCBpOiBudW1iZXIgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgY29uc3QgYm46IEJOID0gbmV3IEJOKGkpXG4gICAgbGV0IGxlbmd0aDogbnVtYmVyID0gMzJcbiAgICBsZXQgdHhpZDogQnVmZmVyID0gQnVmZmVyLmZyb20oXG4gICAgICBjcmVhdGVIYXNoKFwic2hhMjU2XCIpLnVwZGF0ZShiaW50b29scy5mcm9tQk5Ub0J1ZmZlcihibiwgbGVuZ3RoKSkuZGlnZXN0KClcbiAgICApXG4gICAgbGVuZ3RoID0gNFxuICAgIGxldCB0eGlkeDogQnVmZmVyID0gQnVmZmVyLmZyb20oYmludG9vbHMuZnJvbUJOVG9CdWZmZXIoYm4sIGxlbmd0aCkpXG4gICAgY29uc3Qgb3V0OiBTRUNQVHJhbnNmZXJPdXRwdXQgPSBuZXcgU0VDUFRyYW5zZmVyT3V0cHV0KFxuICAgICAgYW1vdW50LFxuICAgICAgYWRkcmVzc2VzLFxuICAgICAgbG9ja3RpbWUsXG4gICAgICB0aHJlc2hvbGRcbiAgICApXG4gICAgY29uc3QgeGZlcm91dDogVHJhbnNmZXJhYmxlT3V0cHV0ID0gbmV3IFRyYW5zZmVyYWJsZU91dHB1dChhc3NldElELCBvdXQpXG4gICAgb3V0cHV0cy5wdXNoKHhmZXJvdXQpXG5cbiAgICBjb25zdCB1OiBVVFhPID0gbmV3IFVUWE8oXG4gICAgICBQbGF0Zm9ybVZNQ29uc3RhbnRzLkxBVEVTVENPREVDLFxuICAgICAgdHhpZCxcbiAgICAgIHR4aWR4LFxuICAgICAgYXNzZXRJRCxcbiAgICAgIG91dFxuICAgIClcbiAgICB1dHhvcy5wdXNoKHUpXG4gICAgdHhpZCA9IHUuZ2V0VHhJRCgpXG4gICAgdHhpZHggPSB1LmdldE91dHB1dElkeCgpXG5cbiAgICBjb25zdCBpbnB1dDogU0VDUFRyYW5zZmVySW5wdXQgPSBuZXcgU0VDUFRyYW5zZmVySW5wdXQoYW1vdW50KVxuICAgIGNvbnN0IHhmZXJpbjogVHJhbnNmZXJhYmxlSW5wdXQgPSBuZXcgVHJhbnNmZXJhYmxlSW5wdXQoXG4gICAgICB0eGlkLFxuICAgICAgdHhpZHgsXG4gICAgICBhc3NldElELFxuICAgICAgaW5wdXRcbiAgICApXG4gICAgaW5wdXRzLnB1c2goeGZlcmluKVxuICB9XG4gIHNldC5hZGRBcnJheSh1dHhvcylcblxuICBjb25zdCBjcmVhdGVDaGFpblR4ID0gbmV3IENyZWF0ZUNoYWluVHgoXG4gICAgbmV0d29ya0lELFxuICAgIGJpbnRvb2xzLmNiNThEZWNvZGUocENoYWluQmxvY2tjaGFpbklEKSxcbiAgICBvdXRwdXRzLFxuICAgIGlucHV0cyxcbiAgICBtZW1vLFxuICAgIHN1Ym5ldElELFxuICAgIGNoYWluTmFtZVN0cixcbiAgICB2bUlEU3RyLFxuICAgIGZ4SURzU3RyLFxuICAgIGdkLFxuICAgIHN1Ym5ldEF1dGhcbiAgKVxuICB0ZXN0KFwiYnVpbGRDcmVhdGVDaGFpblR4XCIsIGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgICBjb25zdCBhZGRyczFTdHJzOiBzdHJpbmdbXSA9IGFkZHJzMS5tYXAoKGEpOiBzdHJpbmcgPT5cbiAgICAgIGJpbnRvb2xzLmFkZHJlc3NUb1N0cmluZyhcImxvY2FsXCIsIFwiUFwiLCBhKVxuICAgIClcbiAgICBjb25zdCByZXN1bHQ6IFByb21pc2U8VW5zaWduZWRUeD4gPSBwY2hhaW4uYnVpbGRDcmVhdGVDaGFpblR4KFxuICAgICAgc2V0LFxuICAgICAgYWRkcnMxU3RycyxcbiAgICAgIGFkZHJzMVN0cnMsXG4gICAgICBzdWJuZXRJRCxcbiAgICAgIGNoYWluTmFtZVN0cixcbiAgICAgIHZtSURTdHIsXG4gICAgICBmeElEc1N0cixcbiAgICAgIGdkLFxuICAgICAgc3VibmV0QXV0aCxcbiAgICAgIG1lbW9cbiAgICApXG4gICAgY29uc3QgcGF5bG9hZDogb2JqZWN0ID0ge1xuICAgICAgcmVzdWx0OiB7XG4gICAgICAgIGFzc2V0SUQ6IFwiMmZvbWJoTDdhR1B3ajNLSDRiZnJtSndXNlBWbk1vYmY5WTJmbjlHd3hpQUFKeUZEYmVcIlxuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCByZXNwb25zZU9iajogSHR0cFJlc3BvbnNlID0ge1xuICAgICAgZGF0YTogcGF5bG9hZFxuICAgIH1cblxuICAgIG1vY2tBeGlvcy5tb2NrUmVzcG9uc2UocmVzcG9uc2VPYmopXG4gICAgY29uc3QgdHh1MTogVW5zaWduZWRUeCA9IGF3YWl0IHJlc3VsdFxuXG4gICAgY29uc3QgdHh1MjogVW5zaWduZWRUeCA9IHNldC5idWlsZENyZWF0ZUNoYWluVHgoXG4gICAgICBuZXR3b3JrSUQsXG4gICAgICBiaW50b29scy5jYjU4RGVjb2RlKGJsb2NrY2hhaW5JRCksXG4gICAgICBhZGRyczEsXG4gICAgICBhZGRyczEsXG4gICAgICBzdWJuZXRJRCxcbiAgICAgIGNoYWluTmFtZVN0cixcbiAgICAgIHZtSURTdHIsXG4gICAgICBmeElEc1N0cixcbiAgICAgIGdkLFxuICAgICAgc3VibmV0QXV0aCxcbiAgICAgIHBjaGFpbi5nZXRDcmVhdGVDaGFpblR4RmVlKCksXG4gICAgICBhc3NldElELFxuICAgICAgbWVtb1xuICAgIClcblxuICAgIGV4cGVjdCh0eHUyLnRvQnVmZmVyKCkudG9TdHJpbmcoXCJoZXhcIikpLnRvQmUoXG4gICAgICB0eHUxLnRvQnVmZmVyKCkudG9TdHJpbmcoXCJoZXhcIilcbiAgICApXG4gICAgZXhwZWN0KHR4dTIudG9TdHJpbmcoKSkudG9CZSh0eHUxLnRvU3RyaW5nKCkpXG5cbiAgICBjb25zdCB0eCA9IHR4dTEuZ2V0VHJhbnNhY3Rpb24oKSBhcyBDcmVhdGVDaGFpblR4XG4gICAgY29uc3QgdHhUeXBlOiBudW1iZXIgPSB0eC5nZXRUeFR5cGUoKVxuICAgIGV4cGVjdCh0eFR5cGUpLnRvQmUoUGxhdGZvcm1WTUNvbnN0YW50cy5DUkVBVEVDSEFJTlRYKVxuXG4gICAgY29uc3Qgc2E6IFN1Ym5ldEF1dGggPSB0eC5nZXRTdWJuZXRBdXRoKClcbiAgICBleHBlY3Qoc2EpLnRvQmUoc3VibmV0QXV0aClcblxuICAgIGNvbnN0IHNJRDogc3RyaW5nID0gdHguZ2V0U3VibmV0SUQoKVxuICAgIGV4cGVjdChzSUQpLnRvQmUoc3VibmV0SURTdHIpXG5cbiAgICBjb25zdCB2SUQ6IEJ1ZmZlciA9IHR4LmdldFZNSUQoKVxuICAgIGV4cGVjdCh2SUQudG9TdHJpbmcoKSkudG9NYXRjaCh2bUlEU3RyKVxuXG4gICAgY29uc3QgY05hbWU6IHN0cmluZyA9IHR4LmdldENoYWluTmFtZSgpXG4gICAgZXhwZWN0KGNOYW1lKS50b0JlKGNoYWluTmFtZVN0cilcblxuICAgIGNvbnN0IGZJRHM6IEJ1ZmZlcltdID0gdHguZ2V0RlhJRHMoKVxuICAgIGV4cGVjdChmSURzLmxlbmd0aCkudG9CZSgzKVxuICAgIGZJRHMuZm9yRWFjaCgoZnhJRDogQnVmZmVyLCBpbmRleDogbnVtYmVyKTogdm9pZCA9PiB7XG4gICAgICBleHBlY3QoZnhJRC50b1N0cmluZygpKS50b01hdGNoKGZ4SURzU3RyW2luZGV4XSlcbiAgICB9KVxuXG4gICAgY29uc3QgZ0RhdGE6IHN0cmluZyA9IHR4LmdldEdlbmVzaXNEYXRhKClcbiAgICBleHBlY3QoZ0RhdGEpLnRvQmUoZ2VuZXNpc0RhdGFTdHIpXG4gIH0pXG4gIHRlc3QoXCJjcmVhdGVDaGFpblR4IGdldENoYWluTmFtZVwiLCAoKTogdm9pZCA9PiB7XG4gICAgY29uc3QgY2hhaW5OYW1lOiBzdHJpbmcgPSBjcmVhdGVDaGFpblR4LmdldENoYWluTmFtZSgpXG4gICAgZXhwZWN0KGNoYWluTmFtZSkudG9CZShjaGFpbk5hbWVTdHIpXG4gIH0pXG5cbiAgdGVzdChcImNyZWF0ZUNoYWluVHggZ2V0VHhUeXBlXCIsICgpOiB2b2lkID0+IHtcbiAgICBjb25zdCB0eFR5cGU6IG51bWJlciA9IGNyZWF0ZUNoYWluVHguZ2V0VHhUeXBlKClcbiAgICBleHBlY3QodHhUeXBlKS50b0JlKFBsYXRmb3JtVk1Db25zdGFudHMuQ1JFQVRFQ0hBSU5UWClcbiAgfSlcbiAgdGVzdChcImNyZWF0ZUNoYWluVHggZ2V0U3VibmV0QXV0aFwiLCAoKTogdm9pZCA9PiB7XG4gICAgY29uc3Qgc2E6IFN1Ym5ldEF1dGggPSBjcmVhdGVDaGFpblR4LmdldFN1Ym5ldEF1dGgoKVxuICAgIGV4cGVjdChzYSkudG9CZShzdWJuZXRBdXRoKVxuICB9KVxuICB0ZXN0KFwiY3JlYXRlQ2hhaW5UeCBnZXRTdWJuZXRJRFwiLCAoKTogdm9pZCA9PiB7XG4gICAgY29uc3Qgc3VibmV0SUQ6IHN0cmluZyA9IGNyZWF0ZUNoYWluVHguZ2V0U3VibmV0SUQoKVxuICAgIGV4cGVjdChzdWJuZXRJRCkudG9CZShzdWJuZXRJRFN0cilcbiAgfSlcbiAgdGVzdChcImNyZWF0ZUNoYWluVHggZ2V0Vk1JRFwiLCAoKTogdm9pZCA9PiB7XG4gICAgY29uc3Qgdm1JRDogQnVmZmVyID0gY3JlYXRlQ2hhaW5UeC5nZXRWTUlEKClcbiAgICBleHBlY3Qodm1JRC50b1N0cmluZygpKS50b01hdGNoKHZtSURTdHIpXG4gIH0pXG4gIHRlc3QoXCJjcmVhdGVDaGFpblR4IGdldENoYWluTmFtZVwiLCAoKTogdm9pZCA9PiB7XG4gICAgY29uc3QgY2hhaW5OYW1lOiBzdHJpbmcgPSBjcmVhdGVDaGFpblR4LmdldENoYWluTmFtZSgpXG4gICAgZXhwZWN0KGNoYWluTmFtZSkudG9CZShjaGFpbk5hbWVTdHIpXG4gIH0pXG4gIHRlc3QoXCJjcmVhdGVDaGFpblR4IGdldEZYSURzXCIsICgpOiB2b2lkID0+IHtcbiAgICBjb25zdCBmeElEczogQnVmZmVyW10gPSBjcmVhdGVDaGFpblR4LmdldEZYSURzKClcbiAgICBleHBlY3QoZnhJRHMubGVuZ3RoKS50b0JlKDMpXG4gICAgZnhJRHMuZm9yRWFjaCgoZnhJRDogQnVmZmVyLCBpbmRleDogbnVtYmVyKTogdm9pZCA9PiB7XG4gICAgICBleHBlY3QoZnhJRC50b1N0cmluZygpKS50b01hdGNoKGZ4SURzU3RyW2luZGV4XSlcbiAgICB9KVxuICB9KVxuICB0ZXN0KFwiY3JlYXRlQ2hhaW5UeCBnZXRHZW5lc2lzRGF0YVwiLCAoKTogdm9pZCA9PiB7XG4gICAgY29uc3QgZ2VuZXNpc0RhdGE6IHN0cmluZyA9IGNyZWF0ZUNoYWluVHguZ2V0R2VuZXNpc0RhdGEoKVxuICAgIGV4cGVjdChnZW5lc2lzRGF0YSkudG9CZShnZW5lc2lzRGF0YVN0cilcbiAgfSlcbiAgdGVzdChcImNyZWF0ZUNoYWluVHggZnJvbUJ1ZmZlclwiLCAoKTogdm9pZCA9PiB7XG4gICAgY29uc3QgY3JlYXRlQ2hhaW5UeEJ1ZjogQnVmZmVyID0gY3JlYXRlQ2hhaW5UeC50b0J1ZmZlcigpXG4gICAgY29uc3QgY3JlYXRlQ2hhaW5UeDI6IENyZWF0ZUNoYWluVHggPSBuZXcgQ3JlYXRlQ2hhaW5UeCgpXG4gICAgY3JlYXRlQ2hhaW5UeDIuZnJvbUJ1ZmZlcihjcmVhdGVDaGFpblR4QnVmKVxuICAgIGV4cGVjdChjcmVhdGVDaGFpblR4QnVmLnRvU3RyaW5nKFwiaGV4XCIpKS50b01hdGNoKFxuICAgICAgY3JlYXRlQ2hhaW5UeDIudG9CdWZmZXIoKS50b1N0cmluZyhcImhleFwiKVxuICAgIClcbiAgfSlcbn0pXG4iXX0=